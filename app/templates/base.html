<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>NfoFetch - 影片刮削工具</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/modern-normalize@2.0.0/modern-normalize.min.css"
    />
    <link rel="stylesheet" href="{{ url_for('static', path='/css/style.css') }}" />
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  </head>
  <body>
    <header class="nf-header">
      <div class="nf-container">
        <h1 class="nf-title">NfoFetch</h1>
        <p class="nf-subtitle">
          FastAPI + HTMX 影片刮削器（Jellyfin NFO，当前支持 javdb）
        </p>
      </div>
    </header>
    <main class="nf-main">
      <div class="nf-container">
        {% block content %}{% endblock %}
      </div>
    </main>
    <footer class="nf-footer">
      <div class="nf-container">
        <small>输出根目录默认为运行目录下的 <code>output/</code>，可通过环境变量 <code>NFOFETCH_OUTPUT_ROOT</code> 修改。</small>
      </div>
    </footer>
    <script>
      // 使用 htmx 提供的 detail.elt 来判断是哪个元素发起请求
      document.addEventListener("htmx:beforeRequest", function (evt) {
        var elt = evt.detail && evt.detail.elt;
        if (!elt || !(elt instanceof HTMLElement)) return;
        if (elt.id !== "scrape-form") return;
        var btn = elt.querySelector("#scrape-button");
        if (btn instanceof HTMLButtonElement) {
          btn.disabled = true;
          btn.innerText = "正在刮削…";
        }
      });

      document.addEventListener("htmx:afterRequest", function (evt) {
        var elt = evt.detail && evt.detail.elt;
        if (!elt || !(elt instanceof HTMLElement)) return;
        if (elt.id !== "scrape-form") return;
        var btn = elt.querySelector("#scrape-button");
        if (btn instanceof HTMLButtonElement) {
          btn.disabled = false;
          btn.innerText = "开始刮削";
        }
      });
    </script>
  </body>
</html>

